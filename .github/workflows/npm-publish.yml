name: Publish npm packages

on:
  workflow_dispatch:
    inputs:
      release_type:
        description: 'Type of publish (one of: rc, main, both, hotfix)'
        required: true
        default: 'rc'
      branch:
        description: 'Hotfix branch'
        required: false

jobs:
  publish_both:
    name: Publish release and release candidate
    if: ${{ github.event.inputs.release_type == 'both' }}
    steps:
      -
        name: Publish release
        uses: ./.github/workflows/reusable-release.yml
        with:
          release_type: main
        secrets: inherit
      -
        name: Publish release candidate
        uses: ./.github/workflows/reusable-release.yml
        with:
          release_type: rc
        secrets: inherit

  publish_main:
    name: Publish release
    if: ${{ github.event.inputs.release_type == 'main' }}
    uses: ./.github/workflows/reusable-release.yml
    with:
      release_type: main
    secrets: inherit

  publish_rc:
    name: Publish release candidate
    if: ${{ github.event.inputs.release_type == 'rc' }}
    uses: ./.github/workflows/reusable-release.yml
    with:
      release_type: rc
    secrets: inherit

  publish_hotfix:
    name: Publish hotfix
    if: ${{ github.event.inputs.release_type == 'hotfix' }}
    uses: ./.github/workflows/reusable-release.yml
    with:
      release_type: hotfix
      branch: ${{ github.event.inputs.branch }}
    secrets: inherit
