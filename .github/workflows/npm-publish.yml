name: Publish npm packages

on:
  workflow_dispatch:
    inputs:
      release_type:
        description: 'Type of publish (one of: rc, main, both, hotfix)'
        required: true
        default: 'rc'
      branch:
        description: 'Hotfix branch'
        required: false

jobs:
  main:
    if: ${{ github.event.inputs.release_type != 'hotfix' }}
    uses: ./.github/workflows/reusable-release.yml
    with:
      release_type: main
    secrets: inherit

  rc:
    needs: main
    if: ${{ github.event.inputs.release_type != 'hotfix' }}
    uses: ./.github/workflows/reusable-release.yml
    with:
      release_type: rc
    secrets: inherit

  hotfix:
    if: ${{ github.event.inputs.release_type == 'hotfix' }}
    uses: ./.github/workflows/reusable-release.yml
    with:
      release_type: hotfix
      branch: ${{ github.event.inputs.branch }}
    secrets: inherit
